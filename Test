@Override
public boolean handleRequest(MessageContext messageContext, Object endpoint) throws WebServiceClientException {
    try {
        ByteArrayOutputStream reqOut = new ByteArrayOutputStream();
        messageContext.getRequest().writeTo(reqOut);
        DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
        factory.setNamespaceAware(true);
        factory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);
        DocumentBuilder builder = factory.newDocumentBuilder();
        builder.parse(new ByteArrayInputStream(reqOut.toByteArray()));
    } catch (Exception e) {
        logger.error("Malformed request XML detected. Returning default SOAP Fault.", e);

        try {
            SaajSoapMessage soapResponse = (SaajSoapMessage) messageContext.getResponse();
            soapResponse.setFault(true);
            soapResponse.getSoapBody().addClientOrSenderFault("Internal Error", null);
            messageContext.getResponse().setFault(true); // Ensures HTTP 500
        } catch (Exception innerEx) {
            logger.error("Failed to send SOAP Fault.", innerEx);
        }

        return false; // Don't continue the chain
    }

    return true; // Proceed if valid
}
