@Override
public boolean handleRequest(MessageContext messageContext, Object endpoint) throws WebServiceClientException {
    try {
        ByteArrayOutputStream reqOut = new ByteArrayOutputStream();
        messageContext.getRequest().writeTo(reqOut);

        DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
        factory.setNamespaceAware(true);
        factory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);
        DocumentBuilder builder = factory.newDocumentBuilder();
        builder.parse(new ByteArrayInputStream(reqOut.toByteArray())); // Throws exception if malformed
    } catch (Exception e) {
        logger.error("Malformed XML detected. Returning SOAP Fault...");

        try {
            SaajSoapMessage soapResponse = (SaajSoapMessage) messageContext.getResponse();
            soapResponse.getSaajMessage()
                        .getSOAPBody()
                        .addFault(
                            soapResponse.getSaajMessage().getSOAPPart().getEnvelope().createName("Client", "env", "http://schemas.xmlsoap.org/soap/envelope/"),
                            "Internal Error"
                        );
        } catch (Exception innerEx) {
            logger.error("Error writing SOAP fault for malformed XML", innerEx);
        }

        return false; // Block further processing and return 500
    }

    return true; // Proceed if valid
}
